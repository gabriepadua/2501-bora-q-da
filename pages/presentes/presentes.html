<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirme sua presença</title>
    <link href="presentes.css" rel="stylesheet">
    <link href="presentes.js" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link
        href="https://fonts.googleapis.com/css2?family=IM+Fell+English&family=Imbue:opsz,wght@10..100,100&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../../img/icone.png">
</head>

<body>

    <svg id="scrolling-svg" xmlns="http://www.w3.org/2000/svg" width="46" height="43" viewBox="0 0 46 43" fill="none">
        <path d="M0 0H36C41.5228 0 46 4.47715 46 10V33C46 38.5228 41.5228 43 36 43H0V0Z" fill="white" />
        <path d="M9 16H36.0185" stroke="#612330" stroke-linecap="round" />
        <path d="M9 22H36.0185" stroke="#612330" stroke-linecap="round" />
        <path d="M9 28H36.0185" stroke="#612330" stroke-linecap="round" />
    </svg>
    <div id="popup-box">
        <p><a class="a" href="../../index.html">Inicio</a></p>
        <p><a class="a" href="../local/local.html">Locais</a></p>
        <p><a class="a" href="../presentes/presentes.html">Lista de presentes</a></p>
        <p><a class="a" href="../presenca/presenca.html">Confirme sua presença</a></p>
        <p><a class="a" href="#" onclick="togglePagesContent()">Páginas</a></p>
        <div id="pages-content" style="display: none;">
            <a class="pagininhas" href="../sobre/sobre.html"> Nossa timeline</a><br>
            <a class="pagininhas" href="../padrinhos/padrinhos.html"> Padrinhos</a><br>
            <a class="pagininhas" href="../mensagem/mensagem.html"> Deixe uma mensagem</a><br>
        </div>
    </div>


    <header class="d-flex justify-content-center b">
        <div class="d-flex align-items-center py-2 vw-100">
            <nav class="nav nav-masthead justify-content-center vw-100 bar">
                <a class="nav-link fw-bold py-1 px-2 btn navegacao" href="../../index.html">Inicio</a>
                <a class="nav-link fw-bold py-1 px-2 btn navegacao" href="../local/local.html">Locais</a>
                <a class="nav-link fw-bold py-1 px-2 btn navegacao" id="atual" href="../presentes/presentes.html">Lista
                    de
                    presentes</a>
                <a class="nav-link fw-bold py-1 px-2 btn navegacao" href="../presenca/presenca.html">Confirme sua
                    presença</a>
                <a class="nav-link fw-bold py-1 px-2 btn navegacao" href="#" onclick="openPagesBox()">Páginas <svg
                        id="pagesArrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                        <path
                            d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                    </svg></a>
                <div id="pagesBox" class="pages-box">
                    <a href="../sobre/sobre.html" class="page-link">Nossa timeline</a>
                    <a href="../padrinhos/padrinhos.html" class="page-link">Padrinhos</a>
                    <a href="../mensagem/mensagem.html" class="page-link">Deixe uma mensagem</a>
                </div>
        </div>
    </header>

    <div class="textinhos">
        <h1>Lista de casamento virtual</h1>
        <p>Aqui você encontra nossa lista de presentes.</p>
        <div class="linha"></div>
    </div>

    <div id="productList"></div>
    <div class="pagination-container" id="pagination"></div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getDatabase, ref, child, remove, onValue } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAMHmGt1r3hlH8dLx28ngPMy6ayrz6JMY8",
            authDomain: "teste-presentes.firebaseapp.com",
            projectId: "teste-presentes",
            storageBucket: "teste-presentes.appspot.com",
            messagingSenderId: "1033331364344",
            appId: "1:1033331364344:web:a912f6331efdc5cca7c60d"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        window.firebaseConfig = firebaseConfig;



        const database = getDatabase();
        const itemsRef = ref(database, 'items');



        const productListContainer = document.getElementById("productList");
        const paginationContainer = document.getElementById("pagination");
        let currentPage = 1;

        let itemsPerPage;
        let itemsInRow;
        let itemsPerRowOptions = [4, 3, 2]; // Options for items in a row

        function calculateItemsPerPage() {
            // Adjust these values based on your desired breakpoints
            if (window.innerWidth >= 1200) {
                itemsInRow = itemsPerRowOptions[0];
                return 15;
            } else if (window.innerWidth >= 768) {
                itemsInRow = itemsPerRowOptions[1];
                return 12;
            } else if (window.innerWidth >= 528) {
                itemsInRow = itemsPerRowOptions[2];
                return 9;
            } else {
                itemsInRow = itemsPerRowOptions[2];
                return 8;
            }
        }

        function fetchAndDisplayItems() {
            onValue(itemsRef, (snapshot) => {
                const data = snapshot.val();
                let i = 0;
                let itemsArray = [];

                for (let item in data) {
                    let name = data[item].name;
                    let image = data[item].image;
                    let link = data[item].link;
                    let price = data[item].price;

                    itemsArray.push(`
        <div class="product">
            <a href="${link}" target="_blank">
                <img src="${image}" alt="${name}" id="imagem-item">
            </a>
            <h2 class="nome-item">${name}</h2>
            <p class="price-item">R$${price}</p>
            <button class="btn-item" onclick="window.removeItem('${item}')">Presentear</button>
        </div>
    `);

                    i++;
                }

                // Clear existing content
                productListContainer.innerHTML = "";
                // Display items for the current page
                const start = (currentPage - 1) * itemsPerPage;
                const end = start + itemsPerPage;
                const itemsToShow = itemsArray.slice(start, end);

                itemsToShow.forEach((itemHTML) => {
                    let itemElement = document.createElement('div');
                    itemElement.classList.add('produtos-div');
                    itemElement.innerHTML = itemHTML;
                    productListContainer.appendChild(itemElement);
                });

                // Update pagination buttons
                updatePagination(Object.keys(data).length);
            });
        }

        function createPaginationButton(pageNumber) {
            let button = document.createElement('button');
            button.textContent = pageNumber;
            button.classList.add('pagination-button');

            // Add the 'active' class to the first button
            if (pageNumber === 1) {
                button.classList.add('active');
            }

            button.onclick = function () {
                // Remove the 'active' class from all buttons
                let buttons = document.getElementsByClassName('pagination-button');
                for (let i = 0; i < buttons.length; i++) {
                    buttons[i].classList.remove('active');
                }

                // Add the 'active' class to the clicked button
                this.classList.add('active');

                // Update the current page and fetch and display items
                currentPage = pageNumber;
                fetchAndDisplayItems();
            };

            return button;
        }

        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            paginationContainer.innerHTML = "";

            for (let i = 1; i <= totalPages; i++) {
                let button = createPaginationButton(i);
                paginationContainer.appendChild(button);
            }
        }

        // Function to remove an item from the database
        window.removeItem = function (itemKey) {
            const itemRef = ref(database, 'items/' + itemKey);
            remove(itemRef);
        }

        function updateItemsBasedOnWidth() {
            itemsPerPage = calculateItemsPerPage();
            fetchAndDisplayItems(); // Fetch and display items after updating itemsPerPage and itemsInRow
        }

        window.addEventListener('resize', updateItemsBasedOnWidth);

        // Initial update based on window width
        updateItemsBasedOnWidth();
    </script>



    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const scrollingSvg = document.getElementById('scrolling-svg');
            scrollingSvg.addEventListener('click', openBox);
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const scrollingSvg = document.getElementById('scrolling-svg');
            scrollingSvg.addEventListener('click', toggleContent);
        });

        function toggleContent() {
            const scrollingSvg = document.getElementById('scrolling-svg');
            const popupBox = document.getElementById('popup-box');

            const svgRect = scrollingSvg.getBoundingClientRect();

            popupBox.style.top = svgRect.top + 'px';
            popupBox.style.left = svgRect.left + 'px';

            scrollingSvg.style.opacity = '0';
            scrollingSvg.style.visibility = 'hidden';
            popupBox.style.opacity = '1';
            popupBox.style.visibility = 'visible';
        }
    </script>
    <script>
        function togglePagesContent() {
            const pagesContent = document.getElementById('pages-content');

            // Toggle the visibility of pages-content
            pagesContent.style.display = (pagesContent.style.display === 'none') ? 'block' : 'none';
        }
    </script>

    <script>
        function togglePagesContent() {
            const pagesContent = document.getElementById('pages-content');

            // Toggle the visibility of pages-content
            pagesContent.style.display = (pagesContent.style.display === 'none') ? 'block' : 'none';
        }
    </script>

    <script>
        function openPagesBox() {
            var pagesBox = document.getElementById('pagesBox');
            var pagesArrow = document.getElementById('pagesArrow'); // Added this line
            var paginasLink = findPaginasLink();

            if (pagesBox.style.display === 'block') {
                pagesBox.style.display = 'none';
                pagesArrow.style.transform = 'rotate(0deg)'; // Rotate back to the initial position
            } else {
                pagesBox.style.display = 'block';
                pagesArrow.style.transform = 'rotate(180deg)'; // Rotate 180 degrees when opened

                pagesArrow.style.transition = 'transform 0.5s ease';
                pagesBox.style.transition = 'opacity 1s ease, visibility 1s ease';


                // Set the position of the pagesBox below and centered on the "Páginas" link
                var rect = paginasLink.getBoundingClientRect();
                var linkWidth = rect.width;
                var boxWidth = pagesBox.offsetWidth;
                pagesBox.style.top = rect.bottom + 'px';
                pagesBox.style.left = rect.left + (linkWidth - boxWidth) / 2 + 'px';
            }
        }

        function closePagesBoxOnClickOutside(event) {
            var pagesBox = document.getElementById('pagesBox');
            var pagesLink = findPaginasLink();

            if (pagesBox.style.display === 'block' && !pagesBox.contains(event.target) && event.target !== pagesLink) {
                pagesBox.style.display = 'none';
            }
        }

        document.addEventListener('click', closePagesBoxOnClickOutside);

        function findPaginasLink() {
            var navigationLinks = document.querySelectorAll('.navegacao');
            for (var i = 0; i < navigationLinks.length; i++) {
                if (navigationLinks[i].innerText.trim() === 'Páginas') {
                    return navigationLinks[i];
                }
            }
            return null;
        }
    </script>


</body>

</html>